---
const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

const path = Astro.url.pathname;

// On enl√®ve le base du path courant pour travailler proprement
const cleanPath = path.startsWith(base)
  ? path.replace(base.slice(0, -1), "")
  : path;

// Normalise (sans slash final, sauf racine)
const normalized = cleanPath !== "/" ? cleanPath.replace(/\/+$/, "") : "/";

// Mapping FR <-> EN
const map = {
  "/fr": "/en",
  "/fr/": "/en/",
  "/fr/a-propos": "/en/about",
  "/fr/cv": "/en/resume",
  "/fr/travaux": "/en/work",

  "/en": "/fr",
  "/en/": "/fr/",
  "/en/about": "/fr/a-propos",
  "/en/resume": "/fr/cv",
  "/en/work": "/fr/travaux",
};

// Langue courante
const isEn = normalized.startsWith("/en");
const label = isEn ? "Fran√ßais" : "English";

// Cible (fallback intelligent si page non mapp√©e)
let target = map[normalized];

if (!target) {
  if (normalized.startsWith("/fr")) {
    target = normalized.replace(/^\/fr/, "/en");
  } else if (normalized.startsWith("/en")) {
    target = normalized.replace(/^\/en/, "/fr");
  } else {
    target = "/fr";
  }
}

// Ajoute slash final uniquement pour les home
if (target === "/fr") target = "/fr/";
if (target === "/en") target = "/en/";

// üî• Ajoute le base pour GitHub Pages
const finalTarget = `${base}${target.replace(/^\//, "")}`;
---

<a class="lang-switch" href={finalTarget}>
  {label}
</a>
