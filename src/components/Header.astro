---
import LangSwitch from "./LangSwitch.astro";

const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

const headerImg = `${base}header.jpg`;

const { lang = "fr" } = Astro.props;
const prefix = lang === "fr" ? "fr" : "en";

const nav =
  lang === "fr"
    ? [
        ["Accueil", `${base}${prefix}/`],
        ["Ã€ propos", `${base}${prefix}/a-propos/`],
        ["Curriculum Vitae", `${base}${prefix}/cv/`],
        ["Travaux", `${base}${prefix}/travaux/`],
      ]
    : [
        ["Home", `${base}${prefix}/`],
        ["About", `${base}${prefix}/about/`],
        ["Curriculum Vitae", `${base}${prefix}/resume/`],
        ["Work", `${base}${prefix}/work/`],
      ];

// Astro.url.pathname inclut le base (/personal-website/...)
const currentPathRaw = Astro.url.pathname;

// Normalisation (sans slash final, sauf racine)
const normalize = (p) => (p !== "/" ? p.replace(/\/+$/, "") : "/");

const currentPath = normalize(currentPathRaw);
---

<!-- BARRE STICKY (tout en haut) -->
<div class="header-nav" role="navigation" aria-label="Navigation principale">
  <div class="container">
    <div class="header-bar">
      <div class="brand">
        <span class="brand-name">HBD</span>
      </div>

      <nav class="nav" aria-label="Menu">
        {nav.map(([label, href]) => (
          <a
            class={`nav-link ${currentPath === normalize(href) ? "active" : ""}`}
            href={href}
          >
            {label}
          </a>
        ))}
      </nav>

      <div class="right">
        <LangSwitch />
      </div>
    </div>
  </div>
</div>

<header class="header-hero" aria-hidden="true">
  <div
    class="header-image"
    style={`background-image: url(${headerImg});`}
  ></div>
</header>
